<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Why Is Spatially Explicit Discretization Necessary? • sesp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Why Is Spatially Explicit Discretization Necessary?">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">sesp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0-0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/whysed.html">Why Is Spatially Explicit Discretization Necessary?</a></li>
    <li><a class="dropdown-item" href="../articles/pdrm.html">Equivalent Q Values Within Statistical Variance and Linear Regression Framework</a></li>
    <li><a class="dropdown-item" href="../articles/sesp.html">Spatially Explicit Stratified Power Model</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/stscl/sesp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Why Is Spatially Explicit Discretization Necessary?</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stscl/sesp/blob/HEAD/vignettes/whysed.rmd" class="external-link"><code>vignettes/whysed.rmd</code></a></small>
      <div class="d-none name"><code>whysed.rmd</code></div>
    </div>

    
    
<p>We demonstrate the necessity of the spatial explicit discretization
(discretization with spatial soft constraints) method using the
<code>Depression.csv</code> data from the <code>gdverse</code> package.
In this analysis, we select <code>Depression_prevalence</code> as the
dependent variable <span class="math inline">\(Y\)</span> and
<code>PopulationDensity</code> as the independent variable <span class="math inline">\(X\)</span>. <span class="math inline">\(X\)</span>
is randomly shuffled, and the q-value is calculated using both
discretization methods that do and do not account for spatial soft
constraints, with the process repeated 3000 times. We selected
hierarchical clustering with spatial soft constraints and hierarchical
clustering without spatial soft constraints method to represent explicit
and implicit spatial discretization, respectively. At the same time,
natural breaks method and robust discretization are used as the control
in this experiment. The hierarchical clustering with spatial soft
constraints method and hierarchical clustering without spatial soft
constraints method were implemented using the <code>ClustGeo</code>
package, the natural breaks method is implemented based on the
<code>sdsfun</code> package and the robust discretization is implemented
by <code>gdverse</code> package. In subsequent analyses, all
discretization methods applied will discretize the dataset into five
strata for the calculation of the q-values.</p>
<div class="section level3">
<h3 id="install-necessary-r-packages">Install necessary R packages<a class="anchor" aria-label="anchor" href="#install-necessary-r-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"gdverse"</span>,dep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stscl/sesp"</span>,build_vignettes <span class="op">=</span> <span class="cn">TRUE</span>,dep <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-spatial-autocorrelation-of-the-example-data">The spatial autocorrelation of the example data<a class="anchor" aria-label="anchor" href="#the-spatial-autocorrelation-of-the-example-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'extdata/Depression.csv'</span>,package <span class="op">=</span> <span class="st">'gdverse'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'X'</span>,<span class="st">'Y'</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">Depression_prevelence</span>,</span>
<span>                x <span class="op">=</span> <span class="va">PopulationDensity</span><span class="op">)</span></span>
<span><span class="co">## Rows: 1072 Columns: 13</span></span>
<span><span class="co">## ── Column specification ────────────────────────────────────────────────────────────────────────────</span></span>
<span><span class="co">## Delimiter: ","</span></span>
<span><span class="co">## dbl (13): X, Y, Depression_prevelence, PopulationDensity, Population65, NoHealthInsurance, Neigh...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span></span>
<span><span class="fu">sdsfun</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/sdsfun/reference/moran_test.html" class="external-link">moran_test</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span><span class="co">## ***                 global moran test</span></span></code></pre></div>
<table style="width:97%;" class="table">
<colgroup>
<col width="15%">
<col width="19%">
<col width="18%">
<col width="16%">
<col width="11%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th align="center">Variable</th>
<th align="center">MoranI</th>
<th align="center">EI</th>
<th align="center">VarI</th>
<th align="center">zI</th>
<th align="center">pI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">y</td>
<td align="center">0.339557***</td>
<td align="center">-0.0009337</td>
<td align="center">0.0003192</td>
<td align="center">19.06</td>
<td align="center">2.892e-81</td>
</tr>
<tr class="even">
<td align="center">x</td>
<td align="center">0.365364***</td>
<td align="center">-0.0009337</td>
<td align="center">0.0003192</td>
<td align="center">20.5</td>
<td align="center">1.052e-93</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="q-values-corresponding-to-spatial-implicit-discretization">Q values corresponding to spatial implicit discretization<a class="anchor" aria-label="anchor" href="#q-values-corresponding-to-spatial-implicit-discretization"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geom</span> <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="va">dt</span><span class="op">$</span><span class="va">x</span></span>
<span><span class="va">gdist</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">as.dist</a></span><span class="op">(</span><span class="fu">sdsfun</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/sdsfun/reference/sf_distance_matrix.html" class="external-link">sf_distance_matrix</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">hclustgeo_disc</span> <span class="op">=</span> \<span class="op">(</span><span class="va">xv</span>,<span class="va">discnum</span>,<span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">D0</span> <span class="op">=</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">xv</span><span class="op">)</span></span>
<span>  <span class="va">resh</span> <span class="op">=</span> <span class="fu">ClustGeo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ClustGeo/man/hclustgeo.html" class="external-link">hclustgeo</a></span><span class="op">(</span><span class="va">D0</span>,<span class="va">gdist</span>,alpha <span class="op">=</span> <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">resh</span>,<span class="va">discnum</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x_naturaldisc</span> <span class="op">=</span> <span class="fu">sdsfun</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/sdsfun/reference/discretize_vector.html" class="external-link">discretize_vector</a></span><span class="op">(</span><span class="va">x</span>,<span class="fl">5</span>,method <span class="op">=</span> <span class="st">"natural"</span><span class="op">)</span></span>
<span><span class="va">x_hclustdisc</span> <span class="op">=</span> <span class="fu">hclustgeo_disc</span><span class="op">(</span><span class="va">x</span>,<span class="fl">5</span>,alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">x_robustdisc</span> <span class="op">=</span> <span class="fu">gdverse</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/gdverse/reference/robust_disc.html" class="external-link">robust_disc</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>                                 data <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>,x <span class="op">=</span> <span class="va">x</span><span class="op">)</span>,</span>
<span>                                 discnum <span class="op">=</span> <span class="fl">5</span>, cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">qv_naturaldisc</span> <span class="op">=</span> <span class="fu">gdverse</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/gdverse/reference/factor_detector.html" class="external-link">factor_detector</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">x_naturaldisc</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">qv_naturaldisc</span></span>
<span><span class="co">## [1] 0.07985365</span></span>
<span><span class="va">qv_hclustdisc</span> <span class="op">=</span> <span class="fu">gdverse</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/gdverse/reference/factor_detector.html" class="external-link">factor_detector</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">x_hclustdisc</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">qv_hclustdisc</span></span>
<span><span class="co">## [1] 0.07315131</span></span>
<span><span class="va">qv_robustdisc</span> <span class="op">=</span> <span class="fu">gdverse</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/gdverse/reference/factor_detector.html" class="external-link">factor_detector</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">x_robustdisc</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">qv_robustdisc</span></span>
<span><span class="co">## [1] 0.1199684</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="a-monte-carlo-simulation-experiment-demonstrating-the-necessity-of-spatial-explicit-discretization">A Monte Carlo simulation experiment demonstrating the necessity of
spatial explicit discretization<a class="anchor" aria-label="anchor" href="#a-monte-carlo-simulation-experiment-demonstrating-the-necessity-of-spatial-explicit-discretization"></a>
</h3>
<p>In the repeated experiment, <span class="math inline">\(X\)</span> is
shuffled 3000 times, and the global Moran’s I of the original
independent variable <span class="math inline">\(X\)</span> serves as
the degree of spatial soft constraint (0.365 in this case).
Subsequently, the q-values for each simulation round is computed.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mc_simq</span> <span class="op">=</span> \<span class="op">(</span><span class="va">times</span> <span class="op">=</span> <span class="fl">1000</span>, <span class="va">cores</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">doclust</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">cores</span>, <span class="st">"cluster"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">doclust</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">cores</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">doclust</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="va">cores</span> <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">calcul_q</span> <span class="op">=</span> \<span class="op">(</span><span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x_sim</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">g</span> <span class="op">=</span> <span class="fu">sdsfun</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/sdsfun/reference/moran_test.html" class="external-link">moran_test</a></span><span class="op">(</span></span>
<span>      <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x_sim <span class="op">=</span> <span class="va">x_sim</span><span class="op">)</span>,<span class="va">geom</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="va">moran</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">result</span>,<span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="va">moran_p</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">result</span>,<span class="fl">6</span><span class="op">)</span></span>
<span>    <span class="va">x_sed</span> <span class="op">=</span> <span class="fu">hclustgeo_disc</span><span class="op">(</span><span class="va">x_sim</span>, discnum <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">0.365</span><span class="op">)</span></span>
<span>    <span class="va">qv1</span> <span class="op">=</span> <span class="fu">gdverse</span><span class="fu">::</span><span class="fu"><a href="https://stscl.github.io/gdverse/reference/factor_detector.html" class="external-link">factor_detector</a></span><span class="op">(</span><span class="va">y</span>,<span class="va">x_sed</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">res</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>qv_sed <span class="op">=</span> <span class="va">qv1</span>, moran <span class="op">=</span> <span class="va">moran</span>,</span>
<span>                         moran_p <span class="op">=</span> <span class="va">moran_p</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">doclust</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">clusterExport</a></span><span class="op">(</span><span class="va">cores</span>,varlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geom"</span>,<span class="st">"y"</span>,<span class="st">"x"</span>,<span class="st">"gdist"</span>,<span class="st">"hclustgeo_disc"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">out_g</span> <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/clusterApply.html" class="external-link">parLapply</a></span><span class="op">(</span><span class="va">cores</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">times</span>,by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,<span class="va">calcul_q</span><span class="op">)</span></span>
<span>    <span class="va">out_g</span> <span class="op">=</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out_g</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">out_g</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">times</span>,by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,<span class="va">calcul_q</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">out_g</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qv</span> <span class="op">=</span> <span class="fu">mc_simq</span><span class="op">(</span>times <span class="op">=</span> <span class="fl">3000</span>, cores <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span>
<span><span class="va">qv</span></span>
<span><span class="co">## # A tibble: 3,000 × 3</span></span>
<span><span class="co">##    qv_sed     moran moran_p</span></span>
<span><span class="co">##     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1  0.201 -0.000892  0.499 </span></span>
<span><span class="co">##  2  0.175  0.0219    0.100 </span></span>
<span><span class="co">##  3  0.148  0.00743   0.320 </span></span>
<span><span class="co">##  4  0.186 -0.0321    0.959 </span></span>
<span><span class="co">##  5  0.160  0.0123    0.229 </span></span>
<span><span class="co">##  6  0.194 -0.0429    0.991 </span></span>
<span><span class="co">##  7  0.193 -0.0157    0.796 </span></span>
<span><span class="co">##  8  0.181  0.0174    0.152 </span></span>
<span><span class="co">##  9  0.173  0.00307   0.411 </span></span>
<span><span class="co">## 10  0.188  0.0256    0.0690</span></span>
<span><span class="co">## # ℹ 2,990 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">qv</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">qv_sed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span>,</span>
<span>                          color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Q Value"</span>,</span>
<span>                y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/whysed/plot_mcres_1-1.png" alt="Figure 1. The results of q-values from 1000 explicit spatial discretization simulations."><div class="figcaption">
<strong>Figure 1</strong>. The results of
q-values from 1000 explicit spatial discretization simulations.</div>
</div>
<p>We selected simulated q-values that are more consistent with the
actual situation, specifically those for which the global Moran’s I of
the permuted data is statistically significant (p-value &lt; 0.05) and
greater than zero.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qv_sign</span> <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">qv</span>,<span class="va">moran</span><span class="op">&gt;=</span><span class="fl">0</span><span class="op">&amp;</span><span class="va">moran_p</span><span class="op">&lt;=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">qv_sign</span></span>
<span><span class="co">## # A tibble: 151 × 3</span></span>
<span><span class="co">##    qv_sed  moran moran_p</span></span>
<span><span class="co">##     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">##  1  0.203 0.0391 0.0125 </span></span>
<span><span class="co">##  2  0.178 0.0397 0.0115 </span></span>
<span><span class="co">##  3  0.204 0.0313 0.0354 </span></span>
<span><span class="co">##  4  0.201 0.0433 0.00669</span></span>
<span><span class="co">##  5  0.196 0.0464 0.00403</span></span>
<span><span class="co">##  6  0.185 0.0347 0.0231 </span></span>
<span><span class="co">##  7  0.177 0.0366 0.0178 </span></span>
<span><span class="co">##  8  0.182 0.0409 0.00963</span></span>
<span><span class="co">##  9  0.189 0.0292 0.0457 </span></span>
<span><span class="co">## 10  0.167 0.0351 0.0219 </span></span>
<span><span class="co">## # ℹ 141 more rows</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">qv_sign</span>, <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">qv_sed</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html" class="external-link">after_stat</a></span><span class="op">(</span><span class="va">density</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          bins <span class="op">=</span> <span class="fl">50</span>, fill <span class="op">=</span> <span class="st">"skyblue"</span>,</span>
<span>                          color <span class="op">=</span> <span class="st">"black"</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Q Value"</span>,</span>
<span>                y <span class="op">=</span> <span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="../reference/figures/whysed/plot_mcres_2-1.png" alt="Figure 2. Q-value distribution from randomized simulations that best align with actual conditions."><div class="figcaption">
<strong>Figure 2</strong>. Q-value distribution
from randomized simulations that best align with actual
conditions.</div>
</div>
<p>The q-value derived from classifying into five categories using the
natural breaks method is 0.07985, while the q-value from five-category
hierarchical clustering without spatial constraints is 0.07315. In
comparison, the q-value obtained through robust discretization into five
categories is 0.11997. In the Monte Carlo simulation experiment, the
q-values range from 0.11513 to 0.22323. Among randomized simulations
that best align with actual conditions, the q-value range spans from
0.1345 to 0.21118. These results indicate that spatially implicit
discretization tends to underestimate the q-value of the variable under
moderate spatial autocorrelation, highlighting the importance of
spatially explicit discretization. The results also reveal that robust
discretization, which accounts for the relationship between independent
and dependent variables, can effectively reduce the q-value estimation
bias introduced by spatially implicit discretization methods. However,
it still underestimates the q-value by approximately 35.2949%. This
highlights the need for a spatially explicit discretization approach
that fully considers the relationship between independent and dependent
variables to more accurately capture the impact of spatial dependence on
discretization.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://spatlyu.github.io/" class="external-link">Wenbo Lv</a>, <a href="https://yongzesong.com/" class="external-link">Yongze Song</a>, <a href="https://wufan-zhao.github.io/" class="external-link">Wufan Zhao</a>, <a href="https://gisersqdai.top/mycv/" class="external-link">Shaoqing Dai</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
